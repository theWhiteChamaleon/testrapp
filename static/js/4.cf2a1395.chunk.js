"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[4],{2421:(e,t,a)=>{a.r(t),a.d(t,{initializeWidget:()=>B});var o=a(5043),s=a(4391),l=(a(2342),a(9555),a(4854)),n=a(3003),i=a(2670),r=a(2115),c=a(314),d=(a(8421),a(4050),a(9959),a(174)),u=a(2725),p=a(8012),g=a(3277),m=a(3728),h=a(579);const v=()=>{const{handleDrop:e}=(0,p.A)(),{showSuccessToast:t,showErrorToast:a}=(0,u.A)(),o=(0,n.d4)((e=>e.droppedObject.droppedObjectData.initialDraggedData));return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(m.A,{variant:"outline-secondary",className:"m-2",size:"lg",text:"Refresh",onClick:async()=>{if(o&&o.data.items[0].objectId&&o.data.items[0].objectType&&"function"===typeof e)try{const a=o.data.items;await(0,d.M)(a,e),t(g._l)}catch(s){console.error("Error during refresh:",s),a(g.H6)}else console.error("[onRefresh] initialDraggedData is undefined")}})})};var f=a(9379),b=a(5740),w=(a(4816),a(3637)),A=a(6713),C=a(768),y=a(759),P=a(5645);const S=[{accessorKey:"Plant",header:"Plant"},{accessorKey:"Seq",header:"Seq"},{accessorKey:"MBom",header:"MBom",cell:e=>{let{row:t,getValue:a,table:o}=e;return(0,h.jsxs)("select",{value:a(),onChange:e=>{var a;const s=e.target.value,l=o.getRowModel().rows.map((e=>e.id===t.id?(0,f.A)((0,f.A)({},e.original),{},{MBom:s}):e.original));null===(a=o.options.meta)||void 0===a||a.updateTableData(l)},className:"appearance-none bg-transparent border-none cursor-pointer focus:outline-none",style:{appearance:"none",width:"70%",padding:"5px",fontSize:"14px",color:"#333",background:"none",border:"none",textAlign:"left"},onMouseOver:e=>e.target.style.border="1px solid #ccc",onMouseOut:e=>e.target.style.border="none",children:[(0,h.jsx)("option",{value:"Make",children:"Make"}),(0,h.jsx)("option",{value:"Buy",children:"Buy"})]})}},{accessorKey:"Status",header:"Status"},{accessorKey:"MFG Change",header:"MFG Change"},{accessorKey:"MFG Status",header:"MFG Status"},{accessorKey:"Change",header:"Change"},{accessorKey:"Change Status",header:"Change Status"},{accessorKey:"Oracle Template",header:"Oracle Template"},{accessorKey:"ERP Status",header:"ERP Status"},{accessorKey:"ERP Export",header:"ERP Export"},{accessorKey:"Lead Plant",header:"Lead Plant"},{accessorKey:"Sort Value",header:"Sort Value"}],M=[{accessorKey:"Available Plant",header:"Available Plant"}];var D=a(6047);const j=async(e,t)=>{let a={CAAtt:[]};console.log("We are into Search CA Details");try{var o;const l=await(0,D.fV)(),n=async e=>new Promise(((a,o)=>{l.authenticatedRequest(e,{method:"GET",headers:t,type:"json",onComplete:e=>{console.log("Received response:",e),a(e)},onFailure:e=>{console.error("Request failed:",e),o(e)}})}));let i="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/search?$searchStr=name:".concat(e);const r=null===(o=(await n(i)).changeAction[0])||void 0===o?void 0:o.identifier;if(console.log("Response From 1st Call",r),r){const e="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/".concat(r,"?$fields=proposedChanges,flowDown"),t=await n(e);if(console.log("Response From 2nd Call",t),t){for(const e of t.isFlowDownOf||[])if("Change Action"===e.type){const t="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/".concat(e.identifier,"?$fields=proposedChanges,flowDown");try{const e=await n(t);console.log("Response From 3rd Call",e),e&&a.CAAtt.push({CATitle:e.title,CAState:e.state})}catch(s){console.error("Error fetching parent CA data:",s)}}a.MCOState=t.state,a.MCOTitle=t.title}}return console.log("Final CA Details",a),a}catch(s){throw console.error("Error in SearchCA:",s),s}},x=()=>{const{showErrorToast:e}=(0,u.A)(),t=(0,n.wA)();let a="",o="";(0,l.D)((e=>{o=e.getValue("Credentials"),a=e.getValue("email")})),console.log("Email in usePlantAssignment:",a),console.log("Security Context in usePlantAssignment:",o);return{handlePlantAssignment:async(s,l,n,i)=>{try{t((0,P.Ve)(!0));const r=await(async e=>{try{const t=await(0,D.fV)();console.log("Security Context is:",e);const a="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF?tenant=OI000186152",o=await new Promise(((e,o)=>{t.authenticatedRequest(a,{method:"GET",type:"json",onComplete:e,onFailure:o})})),s=o.csrf.name,l=o.csrf.value,n="SecurityContext",i=e;return{[s]:l,[n]:i}}catch(t){return void console.error("[CSRF] Failed to fetch token:",t)}})(o);if(r){console.log("[UsePlantAssignment] Headers are",r);const e=await(async(e,t,a)=>{try{console.log("[UserGroup Status] ProductId: ",t);const o=await(0,D.fV)();let s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/sharing/getSharing";const l=await new Promise(((a,l)=>{o.authenticatedRequest(s,{method:"POST",headers:(0,f.A)((0,f.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify({data:[{objectID:t}]}),type:"json",onComplete:a,onFailure:l})}));console.log("[Assigned Plant Service] Data received:",l);let n=[],i={groups:[]};if(l&&(l.results.forEach((e=>{e.sharings.userGroups.forEach((e=>{"Can Edit"===e.access&&i.groups.push({uri:e.userGroupID.replace(/[<>]/g,"")})}))})),i.groups.length>0)){let e="https://oi000186152-us1-usersgroup.3dexperience.3ds.com/3drdfpersist/resources/v1/usersgroup/groups?select=uri,members,title";const t=await new Promise(((t,a)=>{o.authenticatedRequest(e,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(i),type:"json",onComplete:t,onFailure:a})}));console.log("Group Response is:",t),t&&(n=t.groups.filter((e=>e.members.includes(a))).map((e=>e.title)))}return console.log("[UserGroup Status] User Groups:",n),n}catch(o){throw console.error("[UserGroup Status] Error occurred:",o),o}})(r,n,a);console.log("[Plant Assignment] User Groups:",e);let o=[...e,s];if(console.log("[Use Plant Assignment] All CollabSpaces:",o),o){const e=await(async(e,t)=>{try{let a=[];console.log("[All Plant Service] CollabSpaces: ",e),console.log("[All Plant Service] headers: ",t);const o=await(0,D.fV)(),s=async e=>new Promise(((a,s)=>{o.authenticatedRequest(e,{method:"GET",headers:t,type:"json",onComplete:e=>{console.log("Received response:",e),a(e)},onFailure:e=>{console.error("Request failed:",e),s(e)}})})),l=e.map((async e=>{try{var t,o;const r="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:Library/search?$searchStr=".concat(e),c=null===(t=(await s(r)).member)||void 0===t||null===(o=t.find((t=>t.title===e)))||void 0===o?void 0:o.id;if(console.log("[All Plant Service] Library id is:",c),c){const e="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:Library/".concat(c,"?$mask=dslib:ExpandClassifiableClassesMask"),t=await s(e),{member:o}=t;if(o&&o.length>0){var l,n;console.log("[Library Data Service] Member found:",o);const e=null===(l=o[0])||void 0===l?void 0:l.ChildClasses;if((null===e||void 0===e||null===(n=e.member)||void 0===n?void 0:n.length)>0){var i;const t=null===(i=e.member[0].ChildClasses)||void 0===i?void 0:i.member;if(t&&t.length>0){const e=t.filter((e=>!a.some((t=>t.id===e.id))));a=[...a,...e]}}}}}catch(r){throw console.error("Error processing group:",e,r),r}}));return await Promise.all(l),a}catch(a){throw console.error("[All Plant Service] Error occurred:",a),a}})(o,r);if(console.log("[Use Plant Assignment] All Plants are:",e),e){const a=await(async(e,t,a)=>{try{console.log("[Assigned Plant Service] Plant Members:",e);const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:ClassifiedItem/".concat(a,"?$mask=dslib:ClassificationAttributesMask"),s=await(0,D.fV)(),l=await new Promise(((e,a)=>{s.authenticatedRequest(o,{method:"GET",headers:t,type:"json",onComplete:e,onFailure:a})}));console.log("[Assigned Plant Service] Data received:",l);let n=[],i=[],r=l.member[0].ClassificationAttributes.member;return await Promise.all(r.map((async a=>{console.log("Class Item is ",a);for(let o of e)if(a.ClassID===o.id){let e=o.title;e=e.replace("Plant","").replace(/\s+/g,"");let s={id:a.ClassID,title:o.title};const l=a.Attributes.map((a=>a.name.includes("FlowDownCA")&&a.value?j(a.value,t).then((e=>{if(e){console.log(e),s.MFGChange=null===e||void 0===e?void 0:e.MCOTitle,s.MFGStatus=null===e||void 0===e?void 0:e.MCOState;let t="",a="";e.CAAtt.forEach((e=>{t+=","+e.CATitle,a+=","+e.CAState})),s.Change=t.slice(1),s.ChangeStatus=a.slice(1)}})):(s[a.name.replace(e,"").trim()]=a.value,Promise.resolve())));await Promise.all(l),n=[...n,s],console.log("Initial Assigned Classes",n),console.log("Processed Object:",s)}}))),console.log("[Assigned Plant Service] Initial Assigned Classes:",n),i=e.filter((e=>!n.some((t=>t.id===e.id)))),console.log("uniqueInAllclasses--:",i),{success:!0,data:{plantData:{allPlants:e,initialAssignedPlants:n,uniquePlants:i}}}}catch(o){return console.error("[Object Details] Failed to fetch data:",o),{success:!1,error:o}}})(e,r,n);console.log("[Use Plant Assignment]: ",a),a.success?(t((0,P.Lq)(a.data.plantData)),t((0,P.lL)(r))):console.error("Failed to fetch plant data")}else console.warn("[Use All Plants] There are no Plants")}else console.warn("[Use All Plants] There are no CollabSpace");let c={};console.log("Type Before:",i),c="Raw_Material"===i?{success:!0,data:[]}:await(async(e,t)=>{let a="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dseng/dseng:EngItem/";a+=t,a+="/expand";let o={expandDepth:1,type_filter_bo:["VPMReference"],type_filter_rel:["VPMInstance"]};try{console.log("[SearchCAService] ProductId is:",t);const s=await(0,D.fV)(),l=(t,a,o)=>new Promise(((l,n)=>{s.authenticatedRequest(t,{method:a,headers:(0,f.A)((0,f.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(o),type:"json",onComplete:e=>{console.log("Received response:",e),l(e)},onFailure:e=>{console.error("Request failed:",e),n(e)}})})),n=await l(a,"POST",o);console.log("[Get CA Details Service] Data received:",n);const{member:i}=n;if(i){let e=n.member.filter((e=>("VPMReference"===e.type||"Raw_Material"===e.type)&&e.id!==t)).map((e=>({id:e.id,type:e.type,name:e.title,state:e.state})));return e.length>0&&await Promise.all(e.map((async e=>{if("released"===e.state.toLowerCase()){let t="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:ClassifiedItem/".concat(e.id,"?$mask=dslib:ClassificationAttributesMask");const a=await l(t,"GET","");console.log("classResponse->",a);const o=a.member.flatMap((e=>{var t;return null!==(t=e.ClassificationAttributes)&&void 0!==t&&t.member?e.ClassificationAttributes.member.map((e=>e.ClassID)):[]}));e.classes=o}}))),{success:!0,data:e}}}catch(s){return console.error("Error while Fetching",s),{success:!1,data:[],error:s}}})(r,n),console.log("Type After:",i),console.log("[Use All Plants] Product Childrens",c),c.success&&t((0,P.VG)(c.data));const d=await(async(e,t,a)=>{let o=!1,s=[];const l="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/enorelnav/v2/navigate/setPreferences";let n={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",relations:["caproposedwhere_from"],allRelationsMode:!1,publicationsMode:!1,computeWithInstances:!1,attributesForView:["ds6w:status","ds6w:type","ds6w:identifier"],label:"ENXENG_AP-e1331143-1734517777960",lang:"en",ghostMode:!1},i={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",responseMode:"objectsByPatterns",label:"ENXENG_AP-e1331143-1734517780491",ids:[t]};try{console.log("[Get CA Details] Product ID:",t);const r=await(0,D.fV)(),c=await new Promise(((t,a)=>{r.authenticatedRequest(l,{method:"POST",headers:(0,f.A)((0,f.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(n),type:"json",onComplete:t,onFailure:a})}));if(console.log("[Get CA Details Service] Data received:",c),"OK"===c.status){const l=await new Promise(((t,a)=>{r.authenticatedRequest("https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/enorelnav/v2/navigate/getEcosystem",{method:"POST",headers:(0,f.A)((0,f.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(i),type:"json",onComplete:t,onFailure:a})}));console.log("[Get CA Details Service] Data received:",l),l.objectsByPatterns.caproposedwhere_from&&await Promise.all(l.objectsByPatterns.caproposedwhere_from.map((async l=>{if("Complete"!==l["ds6w:status"].slice(14)){let n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/".concat(l.id,"?$fields=proposedChanges,flowDown");const i=await new Promise(((t,a)=>{r.authenticatedRequest(n,{method:"GET",headers:e,type:"json",onComplete:t,onFailure:a})}));Array.isArray(i.proposedChanges)&&i.proposedChanges.forEach((e=>{s.push({identifier:e.where.identifier,action:e.whats[0].what})})),o="released"!==a.toLowerCase()||s.some((e=>e.identifier===t&&"Modify"===e.action))}})))}else console.error("Unable to Fetch the ");return console.log("Status is coming inside 7"),console.log("Response Object is:",o),{success:!0,data:o,proposedChanges:s}}catch(r){throw console.error("Failed Request:",{url:l,headers:e,body:n,error:r}),r}})(r,n,l);return console.log("[Use All Plants] Get CA Details",d),d.success&&(t((0,P.ug)(d.data)),t((0,P.aB)(d.proposedChanges))),void console.log("[Plant Assignment] All Services Executed Successfully")}e(g.rK)}catch(r){throw console.error("[Plant Assignment] Error:",r),t((0,P.Ve)(!1)),r}finally{t((0,P.Ve)(!1))}}}},E=()=>{const{showErrorToast:e}=(0,u.A)(),{handlePlantAssignment:t}=x(),[a,s]=(0,o.useState)(!1),l=(0,n.wA)(),i=(0,o.useCallback)((async a=>{try{const s=await(0,c.Sj)({dataItems:a});if(s.success){l((0,P.um)({cardData:s.data.cardData}));const e=s.data.cardData;var o,n;if(console.log("[Dragged Items are]",e),l((0,P.Rr)(!0)),s)await t(e["Collaborative Space"],e["Maturity State"],null===(o=a[0])||void 0===o?void 0:o.objectId,null===(n=a[0])||void 0===n?void 0:n.objectType)}else e(g.wX)}catch(i){console.error("[FetchObjectDetails] Error fetching details:",i),e(g.wX)}finally{s(!1)}}),[l,t]),r=(0,o.useCallback)((async t=>{s(!0),console.log("[handleDrop] handleDrop called with dataItems:",t);try{t&&t.length>0?(l((0,P.AK)({initialDraggedData:t[0]})),await i(t)):console.warn("[handleDrop] No data items to process.")}catch(a){s(!1),console.error("[Drop] Error in handleDrop:",a),console.log("[handleDrop] Error in handleDrop, setting loading to false"),e(g.nz)}}),[i,e]);return{initializeDroppableArea:(0,o.useCallback)((()=>{l((0,P.Rr)(!1));const e=setInterval((()=>{const t=document.querySelector(".droppable-container");t&&(clearInterval(e),(0,c.pn)(t,r))}),100);return()=>clearInterval(e)}),[r,l]),loading:a,handleDrop:r}};var N=a(8931),O=a(7111);const R=e=>{let{data:t,columns:a,buttonText:s="Add Plants",addedItem:l,CAName:n,state:i}=e;const{showWarningToast:r}=(0,u.A)();console.log("[Popup] Data Received: ",t);const[c,d]=(0,o.useState)(t),[p,m]=(0,o.useState)(!1),[v,f]=(0,o.useState)({});(0,o.useEffect)((()=>{d(t)}),[t]);const b=()=>m(!1),w=(0,o.useMemo)((()=>[{id:"select",cell:e=>{let{row:t}=e;return(0,h.jsx)("input",{type:"checkbox",className:"form-check-input",checked:t.getIsSelected(),onChange:t.getToggleSelectedHandler()})}},...a]),[a]),A=(0,N.N4)({data:c,columns:w,state:{rowSelection:v},enableRowSelection:!0,onRowSelectionChange:f,getCoreRowModel:(0,O.HT)()});return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{type:"button",className:"btn btn-outline-primary btn-lg m-2",onClick:()=>{n?m(!0):r("RELEASED"===i?g.sL:g.Ru)},children:s}),p&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"modal d-block",tabIndex:"-1",children:(0,h.jsx)("div",{className:"modal-dialog modal-dialog-centered",style:{maxWidth:"500px"},children:(0,h.jsxs)("div",{className:"modal-content  container",children:[(0,h.jsxs)("div",{className:"modal-header",children:[(0,h.jsx)("h5",{className:"me-5 popup-title",children:a[0].header}),(0,h.jsxs)("div",{children:[(0,h.jsx)("button",{type:"button",className:"btn btn-outline-primary me-3",onClick:()=>A.getToggleAllRowsSelectedHandler()({target:{checked:!0}}),children:"Select All"}),(0,h.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>A.getToggleAllRowsSelectedHandler()({target:{checked:!1}}),children:"Deselect All"})]})]}),(0,h.jsx)("div",{className:"modal-body p-0",children:A.getRowModel().rows.length>0?(0,h.jsx)("div",{className:"overflow-auto",style:{maxHeight:"60vh"},children:A.getRowModel().rows.map((e=>(0,h.jsxs)("div",{className:"p-3 border-bottom d-flex align-items-center",style:{backgroundColor:e.getIsSelected()?"#d5e8f2":"inherit"},children:[(0,h.jsx)("div",{className:"me-3",children:(0,N.Kv)(e.getVisibleCells()[0].column.columnDef.cell,e.getVisibleCells()[0].getContext())}),(0,h.jsx)("div",{children:e.original[a[0].accessorKey]})]},e.id)))}):(0,h.jsx)("p",{className:"text-muted p-3",children:"No data available"})}),(0,h.jsxs)("div",{className:"modal-footer d-flex justify-content-end",style:{backgroundColor:"#f1f1f1"},children:[(0,h.jsx)("button",{type:"button",className:"btn btn-secondary me-2",onClick:b,children:"Close"}),(0,h.jsx)("button",{onClick:()=>{const e=A.getSelectedRowModel().rows.map((e=>e.original["Available Plant"]));console.log("[selected Item]",e),0===e.length?r(g.e1):(f({}),l(e),b())},type:"button",className:"btn btn-primary",children:"Add"})]})]})})}),(0,h.jsx)("div",{className:"modal-backdrop fade show"})]})]})},T=e=>{let{onAddPlant:t,addedPlant:a,onSave:s,onRemove:l,uniquedata:n,uniqueColumn:i,CAName:r,state:c}=e;const{showWarningToast:d}=(0,u.A)(),[p,m]=(0,o.useState)([]),[v,f]=(0,o.useState)([]);console.log("[Unique Table Data]:",n);return console.log("Added item data:",v),(0,h.jsxs)("div",{className:"d-flex cta-absolute",children:[(0,h.jsx)(R,{data:n,buttonText:"Add Plants",columns:i,CAName:r,addedItem:e=>{if(console.log(e),m(e),e.length>0){const o=e.map((e=>({title:e,Seq:"1",Status:"Current",MFG_Change:"",MFG_Status:"",Change:"",Change_Status:"",Oracle_Template:"","ERP Status":"Active","ERP Export":"Yes","Lead Plant":"false",MBom:"Buy","Sort Value":""})));t(o),f(o),a(e)}},state:c}),(0,h.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>{s&&r?s():d("RELEASED"===c?g.EZ:g.nX)},children:"Save"}),(0,h.jsx)("button",{className:"btn btn-outline-danger btn-lg m-2",onClick:()=>{l&&l()},children:"Remove"})]})},F=()=>{const{initializeDroppableArea:e,loading:t}=E(),[a,s]=(0,o.useState)(0),[l,i]=(0,o.useState)([]),[r,c]=(0,o.useState)([]),[d,p]=(0,o.useState)([]),[m,v]=(0,o.useState)([]),[j,x]=(0,o.useState)(!1),[N,O]=(0,o.useState)(!1),R=(0,n.wA)(),{showSuccessToast:F}=(0,u.A)();console.log("Table Data after Adding:",l);const I=(0,n.d4)((e=>e.droppedObject.selectedTableRows)),B=(0,n.d4)((e=>e.droppedObject.droppedObjectData));console.log("droppedObjectData",B);const k=(0,n.d4)((e=>e.droppedObject.loadingParentDetails));console.log("Parents Loading State:",k);const q=(0,n.d4)((e=>e.droppedObject.plantObjectData.proposedChanges));console.log("Proposed Changes are:",q);const G=(0,n.d4)((e=>e.droppedObject.isDropped)),V=(0,n.d4)((e=>e.droppedObject.plantObjectData.allPlants));console.log("[PlantAssignment] plant object data: ",V);const U=(0,n.d4)((e=>e.droppedObject.plantObjectData.uniquePlants));console.log("[Plant Assignment] Unique Plants:",U),(0,o.useEffect)((()=>{p(U)}),[U]);const _=(0,n.d4)((e=>e.droppedObject.plantObjectData.initialAssignedPlants));console.log("The Assigned Plants are:",_);const L=(0,n.d4)((e=>e.droppedObject.plantObjectData.productChildren));console.log("[Plant Assignment] Product Children:",L);const K=(0,n.d4)((e=>e.droppedObject.plantObjectData.CAName));console.log("[plant Assignment] CAName:",K);const H=(0,n.d4)((e=>e.droppedObject.plantObjectData.headers));console.log("[Plant Assignment] Headers are: ",H);if(console.log("Tanble Data is:",l),(0,o.useEffect)((()=>{l.length>=0&&s((e=>e+1))}),[l]),B.cardData&&B.initialDraggedData)var W=B.cardData["Maturity State"],$=B.initialDraggedData.objectType;const[z,J]=(0,o.useState)(_);console.log("Duplicate Initial Assigned Classes are:",z),(0,o.useEffect)((()=>{J(_),c(_)}),[_]);const X=async e=>{var t;let a={};const o=[];console.log("Table Data",e),console.log("Before DupInitialAssignedClasses:",z);let s=[];const l=z.map((t=>{let o=(0,f.A)({},t);return e.forEach((e=>{var t;let l={};const n=e.Plant.replace("Plant","").replace(/\s+/g,""),i=null===(t=V.find((t=>t.title===e.Plant)))||void 0===t?void 0:t.id;if(o.title===e.Plant){(o.MBOM?"Make":"Buy")!==e.MBom&&(/^\d/.test(n)?(a["MBOM".concat(n)]="Make"===e.MBom,l.MBOMName="MBOM".concat(n),l.MBOMValue="Make"===e.MBom):(a["".concat(n,"MBOM")]="Make"===e.MBom,l.MBOMName="".concat(n,"MBOM"),l.MBOMValue="Make"===e.MBom),o.MBOM="Make"===e.MBom,l=(0,f.A)((0,f.A)({},l),{},{id:i,title:e.Plant,Type:"Update"}),s.push(l))}})),o}));e.forEach((e=>{if(!z.find((t=>t.title===e.Plant))){var t;const n=e.Plant.replace("Plant","").replace(/\s+/g,""),i=null===(t=V.find((t=>t.title===e.Plant)))||void 0===t?void 0:t.id;if(i){let t={id:i,title:e.Plant},r={};o.push(i),"Make"===e.MBom?(/^\d/.test(n)?(a["MBOM".concat(n)]=!0,r.MBOMName="MBOM".concat(n)):(a["".concat(n,"MBOM")]=!0,r.MBOMName="".concat(n,"MBOM")),t.MBOM=!0,r.MBOMValue=!0):(t.MBOM=!1,r.MBOMValue=!1),l.push(t),r=(0,f.A)((0,f.A)({},r),{},{id:i,title:e.Plant,Type:"New"}),s.push(r)}}}));let n=[];z.forEach((t=>{if(!e.some((e=>e.Plant===t.title))){var a;const e=null===(a=V.find((e=>e.title===t.title)))||void 0===a?void 0:a.id;e&&n.push(e)}})),console.log("Rows getting deleted rowstoDelete:",n),console.log("After DupInitialAssignedClasses:",l),console.log("Classes to be Classified:",o),console.log("Updated Items:",a),console.log();const i=await(async(e,t,a,o,s,l,n,i,r,c,d)=>{try{console.log("[Save Data] Starting data saving process..."),console.log("Type in Save Table Data:",i),console.log("Final aRRAY IS inside Save:",c),console.log("Proposed Changes in Save",d),await(0,D.fV)();let e=n.filter((e=>"released"===e.state.toLowerCase()&&!d.find((t=>t.identifier===e.id&&"modify"===t.action.toLowerCase()))));console.log("NotPropagableChilds ARE :",e);let t=[];c.forEach((a=>{if(a.MBOMValue){let o=[];e.forEach((e=>{e.classes.includes(a.id)||o.push({childId:e.id,childName:e.name})})),t.push({id:a.id,title:a.title,childs:o,type:a.Type})}}));let a="";console.log("ErrorObj IS",t),t.forEach((e=>{let t="";if(Array.isArray(e.childs)&&e.childs.every((e=>e.childName))){const a=e.childs.map((e=>e.childName)).join(", ");console.log("Chilld Titles are",a),t="new"!==e.type.toLowerCase()?"".concat(e.title," plant MBOM can't be modified because childs: ").concat(a," are not classified in ").concat(e.title):"Product can't be classified to ".concat(e.title," plant because childs: ").concat(a," are not classified in ").concat(e.title),console.log("Message is:",t)}else t="Invalid child data for ".concat(e.title,".");a+="".concat(t,"\n")})),console.log(t),console.log("Concatenated Messages:\n",a);let o=c.filter((e=>"new"===e.Type.toLowerCase()&&!t.some((t=>t.id===e.id)))).map((e=>e.id));console.log("New Classes are:",o);let s={};c.forEach((e=>{!t.some((t=>t.id===e.id))&&"update"===e.Type.toLowerCase()&&(s[e.MBOMName]=e.MBOMValue)})),console.log("Update body is:",s);let l=c.filter((e=>e.MBOMValue&&!t.some((t=>t.id===e.id)))).map((e=>e.id));return console.log("Propogateable classes are",l),console.log("All classification API calls completed successfully."),{success:!0,message:"Data saved successfully",ErrorObj:t,Finalmessage:a}}catch(u){return console.error("Error occurred:",u),{success:!1,message:"Failed to save data",error:u}}})(0,0,0,0,null===B||void 0===B||null===(t=B.initialDraggedData)||void 0===t||t.objectId,0,L,$,0,s,q);i.success?(console.log("Save result:",i),F(g.KF)):alert("Error: Unable to Save"),console.log("[Plant Assignment]:",r)};(0,o.useEffect)((()=>{G||e()}),[G,e]),(0,o.useEffect)((()=>{x(k)}),[k]);const Y=(0,o.useMemo)((()=>(e=>e?e.map((e=>({Plant:(null===e||void 0===e?void 0:e.title)||"N/A",Seq:(null===e||void 0===e?void 0:e.Seq)||"1",Status:"Current","MFG Change":(null===e||void 0===e?void 0:e.MFGChange)||"N/A","MFG Status":(null===e||void 0===e?void 0:e.MFGStatus)||"N/A",Change:(null===e||void 0===e?void 0:e.Change)||"N/A","Change Status":(null===e||void 0===e?void 0:e.ChangeStatus)||"N/A","Oracle Template":e.OracleTemplate||"N/A","ERP Status":"Active","ERP Export":"Yes","Lead Plant":!1,MBom:e.MBOM?"Make":"Buy","Sort Value":""}))):[])(r)),[r]),Z=(0,o.useMemo)((()=>(e=>e?e.map((e=>({"Available Plant":(null===e||void 0===e?void 0:e.title)||"N/A"}))):[])(d)),[d]);console.log("[Plant Assignment] Unique Table Data:",Z),(0,o.useEffect)((()=>{Y.length>=0&&(console.log("New Table Data:",Y),i(Y),s((e=>e+1)))}),[Y]);const Q=(0,o.useMemo)((()=>(e=>{if(!e||!e.cardData)return null;const t=e.cardData;let a={title:t.Title||"N/A",type:t.Type||"N/A","Maturity State":t["Maturity State"]||"N/A",owner:t.Owner||"N/A","Collaborative Space Title":t["Collaborative Space Title"]||"N/A",Description:t.Description||"N/A","Dropped Revision":t["Dropped Revision"]||"N/A","Latest Released Revision":t["Latest Released Revision"]||"N/A","CAD Format":t["CAD Format"]||"N/A",imageURL:t.imageURL||"https://oi000186152-us1-space.3dexperience.3ds.com/enovia/snresources/images/icons/large/I_VPMNavProduct108x144.png"};return"Document"!==t.Type&&(a.EIN=t.EIN||"N/A",a["CAD Format"]=t["CAD Format"]||"N/A"),a})(B)),[B]);console.log(Q),(0,o.useEffect)((()=>{O(!!Q)}),[Q]);const ee=(0,o.useMemo)((()=>S),[]),te=(0,o.useMemo)((()=>M),[]);return(0,o.useEffect)((()=>{console.log("[PlantAssignment] State Changes:",{loading:t,loadingParentDetails:k,isDropped:G})}),[t,k,G]),(0,h.jsxs)(h.Fragment,{children:[!G&&!t&&!j&&(0,h.jsx)(b.A,{}),t&&(0,h.jsx)(A.A,{}),G&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"content-wrapper py-3 border-bottom",children:(0,h.jsxs)("div",{className:"d-flex ",children:[(0,h.jsx)("div",{className:" p-0 pt-4",children:(0,h.jsx)(w.A,{src:"https://thewhitechamaleon.github.io/testrapp/images/home.png",alt:"home-icon",className:"home-icon",onClick:()=>{e(),R((0,P.Rr)(!1)),R((0,P.um)({cardData:{},parentDetails:[],versions:[],initialDraggedData:[]})),R((0,P.Lq)({allPlants:[],initialAssignedPlants:[],uniquePlants:[],productChildren:[],CAName:!1,headers:{}})),i([]),O(!1)}})}),Q&&(0,h.jsx)(y.A,{data:Q})]})}),j?(0,h.jsx)("div",{className:"loading-indicator mt-5",children:(0,h.jsx)(A.A,{})}):(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("div",{className:"wrapper-cta",children:[(0,h.jsx)(T,{uniquedata:Z,data:l,uniqueColumn:te,CAName:K,onAddPlant:e=>{console.log("Data Received"),v(e),console.log("[Plant Assignment] Table data",l),console.log("Added Data from Toolbar",e),c((t=>[...e,...t])),s((e=>e+1))},addedPlant:e=>{console.log("The data received from Child is:",e);const t=Z.filter((t=>!e.find((e=>e===t["Available Plant"]))));if(console.log("Updated Table Data after unique:",t),t){const e=t.map((e=>({title:e["Available Plant"]})));console.log(e),p(e)}},onSave:async()=>{console.log("OnSave is Called with the TableData",l),await X(l)},onRemove:async()=>{if(console.log("Selected Table Rows:",I),I.length>0){const e=I.map((e=>e.Plant));console.log("Selected Titles:",e);const t=r.filter((t=>!e.includes(t.title)));console.log("Updated Assigned Plant:",t);const a=r.filter((t=>e.includes(t.title))).map((e=>({title:e.title})));console.log("Removed Titles:",a),c(t),p((e=>[...e,...a]))}else alert("Please select at least one row to remove.")},state:W}),(0,h.jsx)(C.A,{data:l,columns:ee,meta:{updateTableData:e=>{i(e)}}},a)]})})]})]})};if(window.widget&&window.widget.uwaUrl){const e=window.widget.uwaUrl.substring(0,window.widget.uwaUrl.lastIndexOf("/")+1);e?a.p=e:console.error("Invalid uwaUrl format:",window.widget.uwaUrl)}else console.error("uwaUrl is missing. Using default './' as public path."),a.p="./";let I;async function B(){const e=await(0,c.WP)(),t=e.securitycontextpreference,a=e.email;(0,l.D)((e=>{e.setTitle(""),console.log("plant index"),e.addPreference(t),e.setValue("email",a),e.addEvent("onLoad",(()=>{!function(e){var t,a;let o=(null===(t=window.widget)||void 0===t||null===(a=t.body)||void 0===a?void 0:a.querySelector("#root"))||document.getElementById("root");o||(console.warn("Root element not found. Creating dynamically..."),window.widget&&window.widget.body?(o=document.createElement("div"),o.id="root",e.body.appendChild(o)):(o=document.createElement("div"),o.id="root",document.body.appendChild(o))),I||(I=s.createRoot(o)),I.render((0,h.jsxs)(n.Kq,{store:i.A,children:[(0,h.jsx)(v,{children:(0,h.jsx)(F,{})}),(0,h.jsx)(r.N9,{})]}))}()}))}),(e=>{console.error("Widget initialization failed:",e)}))}B()}}]);
//# sourceMappingURL=4.cf2a1395.chunk.js.map